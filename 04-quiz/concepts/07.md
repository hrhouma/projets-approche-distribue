Voici le **workflow** détaillé de l'architecture décrite, en intégrant les différents services AWS comme **EC2**, **Kinesis Data Streams**, **Kinesis Data Firehose**, **Lambda**, **OpenSearch**, et **Cognito**.

### Workflow du Laboratoire

#### 1. **Génération des logs par le serveur EC2**
   - Le serveur **EC2** héberge un **serveur web** (par exemple, Apache) qui enregistre les **logs d’accès** chaque fois qu'un utilisateur visite le site web.
   - Les utilisateurs interagissent avec le site web (en visitant des pages comme `search.php`, `recommendation.php`, etc.). Cela génère des logs d’accès qui incluent des informations sur les **navigateurs utilisés**, les **systèmes d'exploitation**, les **pages visitées**, l'**heure d'accès**, etc.

#### 2. **Ingestion des logs dans Kinesis Data Streams**
   - Les logs générés par le serveur web sur EC2 sont envoyés en **temps réel** à **Kinesis Data Streams** via l’agent Kinesis ou via un script configuré sur l'instance EC2.
   - **Kinesis Data Streams** agit comme un point d'entrée pour **ingérer les données en continu**. Il permet d’absorber un grand volume de données en temps réel et de les préparer pour des traitements ultérieurs.

#### 3. **Transformation des données avec Lambda (facultatif)**
   - **AWS Lambda** est configuré pour être déclenché par les données entrantes dans **Kinesis Data Streams**.
   - Lambda peut enrichir les logs d'accès avec des **informations supplémentaires** (comme la géolocalisation de l’utilisateur à partir de son adresse IP), **nettoyer** les données, ou effectuer des transformations (comme modifier la structure des logs).
   - Une fois que les données sont transformées par Lambda, elles sont renvoyées dans le pipeline pour être ingérées par **Kinesis Data Firehose**.

#### 4. **Buffering et livraison avec Kinesis Data Firehose**
   - Les logs (transformés ou non) sont ensuite transférés de **Kinesis Data Streams** vers **Kinesis Data Firehose**.
   - **Firehose** est responsable du **buffering** et de la **livraison fiable** des logs vers une destination de stockage. Dans ce cas, Firehose est configuré pour livrer les logs à **Amazon OpenSearch Service**.
   - Avant la livraison, Firehose peut également effectuer des transformations supplémentaires via des **fonctions Lambda** (si configuré).

#### 5. **Indexation et stockage dans Amazon OpenSearch Service**
   - **Amazon OpenSearch Service** reçoit les données livrées par **Kinesis Data Firehose**.
   - Les logs sont **indexés** dans OpenSearch, ce qui permet de **rechercher** et **analyser** les données rapidement. Chaque log est stocké comme un document JSON dans un index.

#### 6. **Visualisation avec OpenSearch Dashboards**
   - **OpenSearch Dashboards** permet de créer des **visualisations** basées sur les logs indexés dans OpenSearch.
   - Les utilisateurs peuvent créer des graphiques comme des **diagrammes circulaires** ou des **cartes thermiques** pour obtenir des insights sur les **comportements des visiteurs**, les **navigateurs utilisés**, les **pages les plus consultées**, etc.

#### 7. **Accès sécurisé avec Amazon Cognito**
   - **Amazon Cognito** gère l'**authentification des utilisateurs** qui veulent accéder aux **OpenSearch Dashboards**.
   - Lorsqu’un utilisateur essaie d’accéder aux visualisations dans OpenSearch Dashboards, Cognito vérifie son identité via un **formulaire de connexion**. 
   - Une fois authentifié, l'utilisateur peut accéder aux **tableaux de bord** et aux visualisations.
   - **IAM** gère les **autorisations** spécifiques, contrôlant ce que les utilisateurs peuvent faire ou voir après s'être authentifiés via Cognito.

#### 8. **Surveillance avec Amazon CloudWatch**
   - Les événements générés tout au long du pipeline (depuis Kinesis jusqu'à OpenSearch) peuvent être **surveillés** avec **Amazon CloudWatch**.
   - CloudWatch permet de **visualiser les logs** des événements de transformation et de livraison des données, ainsi que de surveiller les performances des services AWS impliqués (comme Lambda et Firehose).

### Diagramme Simplifié du Workflow :

1. **Utilisateur** accède au site web → 
2. **Serveur EC2** génère des logs d’accès → 
3. **Kinesis Data Streams** ingère les logs en temps réel → 
4. **AWS Lambda** (optionnel) transforme et enrichit les logs → 
5. **Kinesis Data Firehose** bufferise et livre les logs vers OpenSearch → 
6. **Amazon OpenSearch Service** indexe et stocke les logs → 
7. **OpenSearch Dashboards** permet de créer des visualisations à partir des logs → 
8. **Amazon Cognito** gère l’authentification des utilisateurs pour accéder aux visualisations → 
9. **Amazon CloudWatch** surveille les événements et les performances du pipeline.

### Pourquoi cette architecture est-elle avantageuse ?

- **Temps réel** : Grâce à Kinesis, les données sont traitées en continu sans délai.
- **Flexibilité** : Lambda permet d'enrichir et de transformer les logs à la volée.
- **Sécurité** : Cognito garantit que seuls les utilisateurs authentifiés peuvent accéder aux visualisations des données.
- **Simplicité** : Firehose facilite la livraison des données sans avoir à gérer manuellement le buffering ou la livraison.
- **Analyse puissante** : OpenSearch et Dashboards permettent de visualiser les données pour obtenir des insights utiles rapidement.

Ce workflow permet de traiter des données en temps réel, de les enrichir, de les analyser, tout en sécurisant l'accès aux visualisations.
